app.admin_projects_add_page=function(){function r(e){e.preventDefault();if(n)return!1;n=!0;i()?s():n=!1}function i(){e.find(".error_message").hide();e.find("input,select,textarea").removeClass("error");$.trim(t.title.val()).length===0&&t.title.addClass("error").siblings(".error_message.required").show();$.trim(t.completed_date.val()).length===0?t.completed_date.addClass("error").siblings(".error_message.required").show():/^(19|20)\d\d[-\/.](0[1-9]|1[012])[-\/.](0[1-9]|[12][0-9]|3[01])$/.test(t.completed_date.val())===!1&&t.completed_date.addClass("error").siblings(".error_message.invalid").show();return e.find(".error").length===0}function s(){$.ajax({type:"post",url:"/admin/projects/insert",data:e.serialize(),dataType:"json",success:function(e){location.href="/admin/projects/edit/"+e.id}})}var e,t,n=!1;return{init:function(){e=$("#admin_projects_add_page form");t={title:e.find("[name=title]"),completed_date:e.find("[name=completed_date]"),introduction:e.find("[name=introduction]"),description:e.find("[name=description]"),awards:e.find("[name=awards]"),show_lo_award:e.find("[name=show_lo_award]")};e.bind("submit",r);t.completed_date.datepicker({dateFormat:"yy-mm-dd"});t.description.markbar({h1:!1,img:!1,blockquote:!1,code:!1})}}}();app.admin_projects_edit_page=function(){function r(e){e.preventDefault();if(n)return!1;n=!0;i()?s():n=!1}function i(){e.find(".error_message").hide();e.find("input,select,textarea").removeClass("error");$.trim(t.title.val()).length===0&&t.title.addClass("error").siblings(".error_message.required").show();$.trim(t.completed_date.val()).length===0?t.completed_date.addClass("error").siblings(".error_message.required").show():/^(19|20)\d\d[-\/.](0[1-9]|1[012])[-\/.](0[1-9]|[12][0-9]|3[01])$/.test(t.completed_date.val())===!1&&t.completed_date.addClass("error").siblings(".error_message.invalid").show();return e.find(".error").length===0}function s(){$.ajax({type:"post",url:"/admin/projects/update",data:e.serialize(),dataType:"json",success:function(){e.find(".saved_message").fadeIn("fast",function(){setTimeout(function(){e.find(".saved_message").fadeOut("fast")},1e3)});n=!1}})}function o(){confirm("Are you sure you want to delete this project?")&&$.ajax({type:"post",url:"/admin/projects/delete",data:{id:t.id.val()},success:function(){location.href="/admin/projects"}})}function u(){if(confirm("Are you sure you want to delete this photo?")){var t=$(this).closest("li"),n=$(this).data("id");$.ajax({type:"post",url:"/admin/projects/photos/delete",data:{id:n},success:function(){e.find(".photos ul").css({"min-height":0});t.remove();e.find(".photos ul").css({"min-height":e.find(".photos ul").height()+"px"})}})}}var e,t,n=!1;return{init:function(){e=$("#admin_projects_edit_page form");t={id:e.find("[name=id]"),title:e.find("[name=title]"),completed_date:e.find("[name=completed_date]"),introduction:e.find("[name=introduction]"),description:e.find("[name=description]"),awards:e.find("[name=awards]"),show_lo_award:e.find("[name=show_lo_award]")};e.bind("submit",r);e.on("click","button.delete_project",o);e.on("click","button.delete_photo",u);t.completed_date.datepicker({dateFormat:"yy-mm-dd"});t.description.markbar({h1:!1,img:!1,blockquote:!1,code:!1});e.find(".photos ul").sortable({handle:"img",items:"li:not(:first-child)"}).css({"min-height":e.find(".photos ul").height()+"px"});var n=new qq.FineUploaderBasic({button:e.find("a.upload_photo")[0],request:{params:{project_id:t.id.val()},inputName:"image",endpoint:"/admin/projects/photos/insert"},validation:{sizeLimit:15728640,acceptFiles:"image/jpg, image/jpeg, image/tif, image/tiff",stopOnFirstInvalidFile:!1},callbacks:{onError:function(e,t,n){alert(n)},onUpload:function(t,n){e.find(".photos ul").append('<li id="photo_'+t+'" class="uploading"></li>')},onProgress:function(t,n,r,i){var s=Math.round(r/i*100);s>=100?e.find("#photo_"+t).html("Processing "+n+"&hellip;"):e.find("#photo_"+t).html("Uploading "+n+"&hellip; ("+s+"%)")},onComplete:function(t,n,r){if(r.success){html='<img class="thumb" src="/featured-projects/photo/xsmall/'+r.id+'" width="75" height="75">';html+='<div class="tools">';html+='<textarea name="photos[][photo]['+r.id+']"></textarea>';html+='<button type="button" data-id="'+r.id+'" class="delete_photo">Delete</button>';html+="</div>";e.find("#photo_"+t).html(html).removeClass("uploading");e.find(".photos ul").css({"min-height":e.find(".photos ul").height()+"px"})}}}})}}}();